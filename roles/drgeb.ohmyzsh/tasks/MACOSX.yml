---
- name: ensure asdf and ruby is installed via asdf, because we need colorls
  include_tasks: 'asdf.yml'

- name: ensure colorls from ruby is installed.
  gem:
    name: "{{ item.name | default(item) }}"
    state: "{{ item.state | default('present') }}"
    version: "{{ item.version | default(omit) }}"
    user_install: false
    executable: "{{ item.executable | default(omit) }}"
  loop: "{{ ohmyzsh_gem_packages }}"

- name: ensure nerdfonts are installed
  become: false
  import_role:
    name: drew-kun.nerdfonts

- name: 'software | ohmyzsh | install binary'
  become: false
  import_role:
    name: viasite-ansible.zsh

# - name: 'software | znap | install znap'
#   tags:
#     # Suppress warning: [ANSIBLE0006] git used in place of git module
#     # Git module doesn't allow us to set `core.autocrlf=input`.
#     - skip_ansible_lint
#   become: yes
#   become_user: '{{ user.username }}'
#   # core.autocrlf=input prevents https://github.com/robbyrussell/oh-my-zsh/issues/4402
#   command: 'git clone -c core.autocrlf=input --depth=1 https://github.com/marlonrichert/zsh-snap.git .zsh-snap'
#   args:
#     chdir: '~{{ user.username }}'
#     creates: '~{{ user.username }}/.zsh-snap'
#   with_items: "{{ users }}"
#   when: "((user.oh_my_zsh | default({})).install | default(oh_my_zsh_install)) | bool"
#   loop_control:
#     loop_var: user
#     label: '{{ user.username }}'

- name: 'software | ohmyzsh | install autoenv git based dependencies'
  ansible.builtin.git:
    repo: 'git://github.com/inishchith/autoenv.git'
    dest: '{{ ansible_env.HOME }}/.autoenv'
